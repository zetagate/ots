<!DOCTYPE html>
<html>
<head>
	<title>kots</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<link rel="stylesheet" type="text/css" href="dhtmlx/skins/web/dhtmlxgrid.css"/>
	<script src="dhtmlx/codebase/dhtmlxgrid.js"></script>
	<script src="jq_1_11_1.js"></script>
	<script src="db.js"></script>
	<script type="text/javascript">

		const WIDTH = 88;
		const WIDTH_AX = 40; //axis
		const HEIGHT = 30;
		const HEIGHT_AX = 40; //axis
		const MGN = 2;

		/*var reader = new FileReader();
		reader.onload = function() {
			console.log("res = " + reader.result);
		}
		reader.onerror = function(evt) {
			console.log(evt.target.error.code);
		}
		reader.readAsText(file, "UTF-8");*/


		//var oParser = new DOMParser();
		//var oDOM = oParser.parseFromString(SUBJECT_XMLDATA, "text/xml");
		//var arrData = oDOM.documentElement.children;
		var xmlDoc = $.parseXML(SUBJECT_XMLDATA);
		var xmlData = xmlDoc.documentElement.children;

		var db = new Array();
		for(var i=0; i<xmlData.length; i++) {
			var subject = xmlData[i];
			var obj = {};
			for (var j=0; j<subject.children.length; j++) {
				obj[subject.children[j].tagName] = subject.children[j].innerHTML;
			}
			db[i] = obj;
		}

		xmlDoc = null;
		xmlData = null;
		subject = null;


		var grid1;
		var grid2;
		/*
		var lecs = [{p:0, t:"unknown", w:"mon1, mon2"},
			     {p:1, t:"자바", w:"mon1, mon2"},
		             {p:2, t:"자료구조", w:"mon1, mon2"},
		             {p:3, t:"네트워크", w:"mon1, mon2"},
		             {p:4, t:"컴파일러", w:"mon1, mon2"},
		             {p:5, t:"씨언어", w:"mon1, mon2"}];
								 */


		function doOnLoad()
		{

			grid1 = new dhtmlXGridObject("gridbox");
			initGrid(grid1);
			//grid1.load("../common/grid.xml");
			for(var i=0; i<db.length; i++) {
				var note = "";
				if(db[i].eng == "Y") note += "영";
				if(db[i].elr == "Y") note += "E";
				grid1.addRow(i,[db[i].cod, db[i].ttk, db[i].cls, db[i].prf, db[i].tar
												,db[i].crd, db[i].dsg, note, db[i].cap, db[i].dep]);
			}

			grid2 = new dhtmlXGridObject("gridbox2");
			initGrid(grid2);

			grid1.attachEvent("onRowSelect", doOnRowSelect);
			grid1.attachEvent("onRowDblClicked", doOnRowDblClicked);


			setSizes();
			grid1.setSizes();
			grid2.setSizes();

			initCanvas();
		}

		function doOnRowSelect(id, ind)
		{
			console.log("cc");
		}

		function doOnRowDblClicked(id, ind)
		{
			//console.log(grid1.cells(id,0).getValue());
		//	var i = id;
			//grid2.addRow(lecs[i].p,[lecs[i].t,lecs[i].w]);
		}

		window.onresize = function()
		{
			setSizes();
		}

		function initGrid(grid)
		{
			grid.setImagePath("dhtmlx/skins/web/imgs/dhxgrid_web/");
			grid.setHeader("코드,과목명,분반,교수,대상,학점,설계,비고,정원,개설학부");
			grid.setInitWidths("55,130,40,60,70,40,40,40,40,100");
			grid.setColAlign("left,left,left,left,left,left,left,left,left");
			grid.setColTypes("txt,txt,txt,txt,txt,txt,txt,txt,txt,txt");
			grid.setColSorting("str,str,str,str,str,str,str,str,str,str");
			grid.setEditable(false);
			dhtmlxEvent(window, "resize", function () {grid.setSizes();});
			grid.init();
		}

		function setSizes()
		{
			var docuWidth = $(document).width();
			$(wrapper).width(docuWidth-504+480);
		}

		function initCanvas()
		{
			var timeName = ["01A","01B","02A","02B","03A","03B","04A","04B","05A","05B","06A","06B","07A","07B","08A","08B","09A","09B"];
			var weekName = ["월", "화", "수", "목", "금"];

			var canvas = $("#canvas1")[0];
			var ctx = canvas.getContext("2d");

			ctx.beginPath();

			ctx.rect(MGN, MGN, ctx.width-MGN*2, ctx.height-MGN*2);

			ctx.rect(MGN, MGN, WIDTH_AX, HEIGHT_AX);
			for(var i=0; i<18; i++) {
				var xs = MGN;
				var ys = MGN+i*HEIGHT+HEIGHT_AX;
				ctx.rect(xs, ys, WIDTH_AX, HEIGHT);
				ctx.font="13px dotum";
				ctx.fillText(timeName[i],xs+10,ys+15);
			}

			ctx.lineWidth=0.7;
			for(var j=0; j<5; j++) {
				ctx.rect(MGN+j*WIDTH+WIDTH_AX, MGN, WIDTH, HEIGHT_AX);
				ctx.font="13px dotum";
				ctx.fillText(weekName[j],MGN+j*WIDTH+WIDTH_AX+20,MGN+25);
				for(var i=0; i<18; i++) {
					var xs = MGN+j*WIDTH+WIDTH_AX;
					var ys = MGN+i*HEIGHT+HEIGHT_AX;
					ctx.rect(xs, ys, WIDTH, HEIGHT);
				}
			}

			ctx.fillStyle="#9CC99C";
			ctx.fillRect(130, 222, WIDTH, HEIGHT);

			ctx.stroke();

		}




	</script>
</head>
<body onload="doOnLoad()">
	<input type = "file" id="file"/>
	<h1>test</h1>

	<div id="wrapper" style="float:left;width:auto;height:600px;">
	<div id="gridbox" style="width:100%;height:370px;background-color:white;"></div>
	<br />
	<div id="gridbox2" style="width:100%;height:170px;background-color:white;"></div>
	</div>

	<canvas id="canvas1" width=484, height=600, style="float:right;border:1px solid #000000"></canvas>
	<script type="text/javascript">

	</script>
	<br />
	<br />

	<br />

	<br />
</body>
</html>
